/** ! pc 2016-05-06 */
!function(){function a(){$("#amount").on("input",function(a){b(this)}),$("#confirm-btn").on("tap",function(){d()})}function b(a){var b=$(a).val();b=b.replace(/[^0-9]/g,""),$(a).val(b)}function c(a){$.ajax({url:ctx+"/getUserFlow?_="+new Date,type:"get",dataType:"json",success:function(a){h=a.flow,$("#flow").text(a.flow||0)}})}function d(){var a=parseInt($("#amount").val());if(isNaN(a))$("#error-tip").html("请填写赠送额度");else if(0===a)$("#error-tip").html("请填写赠送额度");else if(a>h)$("#error-tip").html("额度超出范围");else{$("#error-tip").html(""),j||(j=g());var b=DIALOG_TEXT.GUIDE.replace("$$amount$$",a);e(j,b,DIALOG_ADS.GUIDE),window.afterGive&&afterGive()}}function e(a,b,c){$(".modal-text",a).html(b);var d=$(".modal-body img",a).attr("src");d!=c.img&&($(".modal-body",a).empty(),$(".modal-body",a).append('<a href="'+c.link+'" target="_blank"><img src="'+c.img+'"></a>')),a.modal("show")}function f(a){var b=$('<div class="modal fade text-center" data-backdrop="static"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"></div><div class="modal-text"></div><div class="modal-tools"><a class="btn btn-img">关 闭</a></div></div></div></div>');a&&a(b),i++,b.attr("id","share_dialog");var c=document.documentElement.clientWidth,d=.85*c,e=d;return $(".modal-dialog",b).height(e),$("body").append(b),b}function g(a){var b=f(function(b){$(".modal-text",b).html(a)});return b.modal(),$(".btn",b).on("tap",function(){window.afterCloseShareDialog&&window.afterCloseShareDialog(),b.modal("hide")}),b}var h=0,i=0,j=null;a(),c(),window.reset=function(){j&&j.modal("hide"),$("#amount").val("")}}();