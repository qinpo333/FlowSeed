/** ! pc 2016-05-06 */
!function(){function a(){$("#code-input").on("input",function(){g($(this),parseInt($(this).attr("maxlength")))}).on("blur",function(){h($(this))})}function b(){$(".get-code").on("click",function(){var a=this,b=k($("#tel-input")[0].value);return $(this).hasClass("btn-disabled")?!1:void($("#tel-input").data("validate")===!0?(m($(a)),$("#code-tip").html(""),$(this).data("isClick",!0),$.post(ctx+"/code",{tel:b},function(){})):""===$("#tel-input").val()&&$("#tel-tip").css("color","red").html("请输入手机号码！"))})}function c(){$("#tel-input").on("focus",function(){j($(this))}).on("input",function(){var a=$(this).val();a=a.replace(/[^0-9-]+/,""),$(this).val(a);var b=this;window.setTimeout(function(){f($(b))},1),g($(this),parseInt($(this).attr("maxlength"))),j($(this))}).on("blur",function(){$(".del-input").addClass("hide"),i($(this))})}function d(){i($("#tel-input"));var a=$("#tel-input").data("validate")===!0;if(!a)return!1;h($("#code-input"));var b=$("#code-input").data("validate")===!0;return a&&b}function e(){$("#submit-btn").on("click",function(){var a=k($("#tel-input")[0].value),b=$("#code-input").val();d()&&(showToast(),r||(r=o("")),$.ajax({url:ctx+"/bind",type:"POST",dataType:"json",data:{tel:a,code:b},success:function(a){hideToast(),a.isUsed?n(r,DIALOG_TEXT.USED,DIALOG_ADS.USED):a.success?n(r,DIALOG_TEXT.SUCCESS,DIALOG_ADS.SUCCESS):(n(r,DIALOG_TEXT.ERROR,DIALOG_ADS.ERROR),$("#code-input").val(""))},error:function(){hideToast(),n(r,DIALOG_TEXT.NET_ERROR,DIALOG_ADS.NET_ERROR)}}))})}function f(a){var b=k(a[0].value);if(""!==b){var c=b.length;3>=c?a[0].value=b:7>=c?a[0].value=b.substring(0,3)+"-"+b.substring(3,c):a[0].value=b.substring(0,3)+"-"+b.substring(3,7)+"-"+b.substring(7,c)}}function g(a,b){a.val().length===b&&window.setTimeout(function(){a.blur()},1)}function h(a){var b=a.val(),c=!1;b?/^[0-9]{6}$/.test(b)?($("#code-tip").html(""),c=!0):$("#code-tip").css("color","red").html("验证码错误！"):$("#code-tip").css("color","red").html("请输入验证码！"),a.data("validate",c)}function i(a){var b=k(a[0].value),c=!1,d=[134,135,136,137,138,139,147,150,151,152,157,158,159,182,183,184,187,188],e=parseInt(b.substr(0,3));b?-1==$.inArray(e,d)?$("#tel-tip").css("color","red").html("请输入移动手机号码！"):/^1[3|4|5|7|8]\d{9}$/.test(b)?($("#tel-tip").css("color","#aaa").html(""),c=!0):$("#tel-tip").css("color","red").html("请输入正确的手机号码！"):$("#tel-tip").css("color","red").html("请输入手机号码！"),a.data("validate",c)}function j(a){""===a.val()?$(".del-input").addClass("hide"):$(".del-input").removeClass("hide")}function k(a){return a.replace(/[-]/g,"")}function l(a){a.val(""),$("#tel-from").html(""),$(".del-input").addClass("hide")}function m(a){0===t?(clearTimeout(s),a.removeClass("btn-disabled"),a.html("重新发送验证码"),t=60):(a.addClass("btn-disabled"),a.html("重新获取("+t+")"),t--,s=setTimeout(function(){m(a)},1e3))}function n(a,b,c){$(".modal-text",a).html(b);var d=$(".modal-body img",a).attr("src");d!=c.img&&($(".modal-body",a).empty(),$(".modal-body",a).append('<a href="'+c.link+'" target="_blank"><img src="'+c.img+'"></a>')),b==DIALOG_TEXT.ERROR||b==DIALOG_TEXT.NET_ERROR?$(".modal-tools a",a).html("再试一次"):$(".modal-tools a",a).html("确 定"),a.modal("show")}function o(a){var b=p(function(b){$(".modal-tools",b).empty(),$(".modal-tools",b).append('<a class="btn btn-img">确 定</a>'),$(".modal-text",b).html(a)});return b.modal(),$(".btn-img",b).on("tap",function(){b.modal("hide"),$(".modal-text",b).html()==DIALOG_TEXT.USED&&window.location.reload(),$(".modal-text",b).html()==DIALOG_TEXT.SUCCESS&&(window.location.href="./index.html")}),b}function p(a){var b=$('<div class="modal fade text-center" data-backdrop="static"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"></div><div class="modal-text"></div><div class="modal-tools"><div class="buttons-wrap"><a class="btn btn-ok">确 定</a></div></div></div></div></div>');a&&a(b),q++,b.attr("id","dialog_"+q);var c=document.documentElement.clientWidth,d=.85*c,e=1.0945*d;return $(".modal-dialog",b).height(e),$("body").append(b),b}var q=0,r=null;$(function(){c(),$(".del-input").on("mousedown",function(){l($("#tel-input")),setTimeout(function(){$("#tel-input").focus()})}).on("touchstart",function(){l($("#tel-input")),setTimeout(function(){$("#tel-input").focus()})}),a(),b(),e()});var s,t=60}();