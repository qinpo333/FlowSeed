/** ! pc 2016-05-06 */
!function(){function a(){var a=ctx+"/getPlants?_="+(new Date).getTime();ajaxData(a,{friendOpenId:friendOpenId},function(a){hideToast();for(var b in a)t[a[b].id]=a[b];d(a)},null,"GET")}function b(a){var b=ctx+"/getUserInfo?_="+(new Date).getTime();ajaxData(b,{friendOpenId:friendOpenId},function(b){$("#user_achievements").html(b.achievements),$("#user_flow").html(b.flow),q=b.name,$(".userName").html(b.name),$(".userPhoto").attr("src",b.photo),a&&a(b)},null,"GET")}function c(){var a=ctx+"/getUserInfo?_="+(new Date).getTime();ajaxData(a,{},function(a){a.isNewUser?$("#tool-join").show():$("#tool-home").show()},null,"GET")}function d(a){a&&a.forEach(function(a){f(a)})}function e(){$("#tool-water").on("tap",function(){$(this).hasClass("active")||($(this).addClass("active"),h())}),$("#tool-rob").on("tap",function(){$(this).hasClass("active")||($(this).addClass("active"),g())}),$("#tool-home,#tool-join").on("tap",function(){window.location.href="./index.html"})}function f(a){var b=i(a),c=$(".trees .tree").eq(a.ground);if(c.length){var d=c.children("img.plant");d.removeAttr("class"),d.addClass("plant"),-1!=a.growthStatus&&d.addClass("plant"+(a.growthStatus+1)).attr("src",b)}}function g(){var a=!0,b=!1;for(var c in t)5!=t[c].growthStatus&&(a=!1),-1!=t[c].growthStatus&&(b=!0);if(!b)return $("#tool-rob").removeClass("active"),void n(o,DIALOG_TEXT.STEAL_NO_PLANTS,DIALOG_ADS.WATER_DEAD);if(0===Object.keys(t).length)return $("#tool-rob").removeClass("active"),void n(o,DIALOG_TEXT.STEAL_NO_PLANTS,DIALOG_ADS.WATER_DEAD);if(a)return $("#tool-rob").removeClass("active"),void n(o,DIALOG_TEXT.STEAL_DEAD,DIALOG_ADS.WATER_DEAD);var d=ctx+"/steal";showToast(),ajaxData(d,{friendOpenId:friendOpenId},function(a){if(hideToast(),$("#tool-rob").removeClass("active"),a&&a.success){var b=DIALOG_TEXT.STEAL.replace("$$COUNT$$",a.flow);n(o,b,DIALOG_ADS.STEAL)}else"none"==a.msg?n(o,DIALOG_TEXT.STEAL_NONE,DIALOG_ADS.STEAL_NONE):"stolen"==a.msg?n(o,DIALOG_TEXT.STOLEN,DIALOG_ADS.STOLEN):"over"==a.msg?n(o,DIALOG_TEXT.STEAL_OVER,DIALOG_ADS.STEAL_OVER):"fail"==a.msg?n(o,DIALOG_TEXT.STEAL_FAIL,DIALOG_ADS.STEAL_FAIL):n(o,DIALOG_TEXT.FAIL,DIALOG_ADS.FAIL)})}function h(){var a=!0,b=!1;for(var c in t)5!=t[c].growthStatus&&(a=!1),-1!=t[c].growthStatus&&(b=!0);return b?0===Object.keys(t).length?($("#tool-water").removeClass("active"),void n(o,DIALOG_TEXT.WATER_NO_PLANTS,DIALOG_ADS.WATER_DEAD)):a?($("#tool-water").removeClass("active"),void n(o,DIALOG_TEXT.WATER_DEAD,DIALOG_ADS.WATER_DEAD)):(showToast(),void $.ajax({url:ctx+"/waterFriend?_="+(new Date).getTime(),type:"get",dataType:"json",data:{friendOpenId:friendOpenId},success:function(a){if(a.success){var b=DIALOG_TEXT.WATER_SUCCESS.replace("$$NAME$$",q);n(o,b,DIALOG_ADS.WATER_SUCCESS)}else"none"==a.msg?n(o,DIALOG_TEXT.WATER_ALL_WATERED,DIALOG_ADS.WATER_ALL_WATERED):"over"==a.msg?n(o,DIALOG_TEXT.WATER_OVER,DIALOG_ADS.WATER_OVER):n(o,DIALOG_TEXT.FAIL,DIALOG_ADS.FAIL);hideToast(),$("#tool-water").removeClass("active")},error:function(){hideToast(),n(o,DIALOG_TEXT.FAIL,DIALOG_ADS.FAIL)}})):($("#tool-water").removeClass("active"),void n(o,DIALOG_TEXT.WATER_NO_PLANTS,DIALOG_ADS.WATER_DEAD))}function i(a){return a.status==s.NEED_ERADICATE?baseUrl+r[5]:baseUrl+r[a.growthStatus]}function j(a){var b=$('<div class="modal fade text-center" data-backdrop="static"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"></div><div class="modal-text"></div><div class="modal-tools"><a class="btn btn-img">确 定</a></div></div></div></div>');a&&a(b),u++,b.attr("id","dialog_"+u);var c=document.documentElement.clientWidth,d=.85*c,e=1.0945*d;return $(".modal-dialog",b).height(e),$("body").append(b),b}function k(a){var b=$('<div class="modal fade text-center" data-backdrop="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"></div><div class="modal-text"></div></div></div></div>');a&&a(b),b.attr("id","share_dialog");var c=document.documentElement.clientWidth,d=.85*c,e=.8*d;return $(".modal-dialog",b).height(e),b.modal(),$("body").append(b),b}function l(a,b){var c=j(function(c){$(".modal-text",c).append(a),b&&($(".modal-tools",c).empty(),$(".modal-tools",c).append('<div class="buttons-wrap"><a class="btn btn-ok">获得更多流量</a><a class="btn btn-cancel">以后再说</a></div>'))});return c.modal(),$(".btn",c).on("tap",function(){c.modal("hide")}),$(".btn-ok",c).on("tap",function(){m()}),c}function m(){p||(p=k()),n(p,DIALOG_TEXT.WATER_SHARE,DIALOG_ADS.WATER_SHARE)}function n(a,b,c){a||(a=l(""));var d=$(".modal-body img",a).attr("src");d!=c.img&&($(".modal-body",a).empty(),$(".modal-body",a).append('<a href="'+c.link+'" target="_blank"><img src="'+c.img+'"></a>')),$(".modal-text",a).html(b),a.modal("show")}var o,p,q=null,r=({harvest:baseUrl+"icon-hand.png",water:baseUrl+"icon-water.png",eradicate:baseUrl+"icon-eradicate.png"},["plant1.png","plant2.png","plant3.png","plant4.png","plant5.png","plant6.png"]),s={NEED_WATER:"0",NEED_HARVEST:"1",NEED_ERADICATE:"2",NONE:"-1"},t={};$(function(){showToast(),b(),c(),a(),e()});var u=0}();