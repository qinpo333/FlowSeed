/** ! pc 2016-05-13 */
!function(){function a(){$("#confirm-btn").on("click",function(){b()})}function b(){var a=$("#tel-input");j(a);var b=a.data("validate");if(!b)return!1;var c=$(".package-size.active").data("value");if(!c)return $("#tip_toast_content").html("请选择流量包"),$("#tipToast").show(),window.setTimeout(function(){$("#tipToast").hide()},2e3),!1;var d=k(a.val()),e=DIALOG_TEXT.CONFIRM.replace("$$FLOW$$",c).replace("$$PHONE$$",d);r||(r=m("")),n(r,e,DIALOG_ADS.CONFIRM),r.tel=d,r.flow=c}function c(){var a=r.tel,b=r.flow;showToast(),s||(s=o()),$.ajax({url:ctx+"/exchange",type:"POST",dataType:"json",data:{tel:a,flow:b},success:function(a){hideToast(),a.success?n(s,DIALOG_TEXT.SUCCESS,DIALOG_ADS.SUCCESS):n(s,DIALOG_TEXT.ERROR,DIALOG_ADS.ERROR)},error:function(){hideToast(),n(s,DIALOG_TEXT.NET_ERROR,DIALOG_ADS.NET_ERROR)}})}function d(){$("#flow-package>ul").on("tap",".package-size",function(){return $(this).hasClass("disabled")||$(this).hasClass("active")?!1:($(".package-size.active").removeClass("active"),void $(this).addClass("active"))})}function e(a){$.ajax({url:ctx+"/getUserFlow?_="+new Date,type:"get",dataType:"json",success:function(b){p=b.flow,$("#flow").text(p||0),a&&a()}})}function f(){$(".package-size").each(function(){var a=parseInt($(this).data("value"));a>p&&$(this).addClass("disabled")})}function g(){$("#tel-input").on("input",function(){var a=$(this).val();a=a.replace(/[^0-9-]+/,""),$(this).val(a);var b=this;window.setTimeout(function(){h($(b))},1),i($(this),parseInt($(this).attr("maxlength")))}).on("blur",function(){j($(this))})}function h(a){var b=k(a[0].value);if(""!==b){var c=b.length;3>=c?a[0].value=b:7>=c?a[0].value=b.substring(0,3)+"-"+b.substring(3,c):a[0].value=b.substring(0,3)+"-"+b.substring(3,7)+"-"+b.substring(7,c)}}function i(a,b){a.val().length===b&&window.setTimeout(function(){a.blur()},1)}function j(a){var b=k(a[0].value),c=!1,d=[134,135,136,137,138,139,147,150,151,152,157,158,159,182,183,184,187,188],e=parseInt(b.substr(0,3));b?-1==$.inArray(e,d)?$(".tel-tip").css("color","red").html("请输入移动手机号码！"):/^1[3|4|5|7|8]\d{9}$/.test(b)?($(".tel-tip").css("color","#aaa").html(""),c=!0):$(".tel-tip").css("color","red").html("请输入正确的手机号码！"):$(".tel-tip").css("color","red").html("请输入手机号码！"),a.data("validate",c)}function k(a){return a.replace(/[-]/g,"")}function l(a){var b=$('<div class="modal fade text-center" data-backdrop="static"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"></div><div class="modal-text"></div><div class="modal-tools"><div class="buttons-wrap"><a class="btn btn-ok">确 定</a><a class="btn btn-cancel">取 消</a></div></div></div></div></div>');a&&a(b),q++,b.attr("id","dialog_"+q);var c=document.documentElement.clientWidth,d=.85*c,e=1.0945*d;return $(".modal-dialog",b).height(e),$("body").append(b),b}function m(a){var b=l(function(b){$(".modal-text",b).html(a)});return b.modal(),b.modal("show"),$(".btn-ok",b).on("click",function(){c(),b.modal("hide")}),$(".btn-cancel",b).on("click",function(){b.modal("hide")}),b}function n(a,b,c){$(".modal-text",a).html(b);var d=$(".modal-body img",a).attr("src");d!=c.img&&($(".modal-body",a).empty(),$(".modal-body",a).append('<a href="'+c.link+'" target="_blank"><img src="'+c.img+'"></a>')),a.modal("show")}function o(a){var b=l(function(b){$(".modal-tools",b).empty(),$(".modal-tools",b).append('<a class="btn btn-img">确 定</a>'),$(".modal-text",b).html(a)});return b.modal(),$(".btn-img",b).on("click",function(){$(".modal-text",b).html()==DIALOG_TEXT.SUCCESS&&history.go(-1),b.modal("hide")}),b}var p=0,q=0,r=null,s=null;g(),d(),a(),e(function(){f()})}();